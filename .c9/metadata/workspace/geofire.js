{"changed":true,"filter":false,"title":"geofire.js","tooltip":"/geofire.js","value":"var GeoFire = require(\"geofire\");\nvar Firebase = require(\"firebase\");\nvar q = require(\"q\");\nvar geofire_export={};\n    var rootRef = new Firebase(\"https://mtdemo.firebaseio.com/\");\n    var usersGeofire = new GeoFire(rootRef.child(\"geomap\").child(\"users\"));\n    var campaignsGeofire = new GeoFire(rootRef.child(\"geomap\").child(\"campaigns\"));\n    \n    \ngeofire_export.init = function(){\n    var d = q.defer();\n    var result={};\n    addUsersToGeofire().then(function(addedUsers){\n        result.addedUsers = addedUsers;\n        addCampaignsToGeofire().then(function(addedCampaigns){\n            result.addedCampaigns=addedCampaigns;\n            d.resolve(result);\n        })\n    })\n    return d.promise;\n\n    \n    \n    \n    \n}\ngeofire_export.usersGeofire=usersGeofire;\ngeofire_export.campaignsGeofire=campaignsGeofire;\nvar addUsersToGeofire = function(){\n    var d =q.defer();\n    var users = [];\n    var addedUsers=[];\n        new Firebase('https://mtdemo.firebaseio.com/users').on('value', function (snapshot) {\n            users = [];\n            snapshot.forEach(function(refChild) {\n                users.push(refChild.val());\n                    });\n             for (var user of users) {\n                if(user.location){\n                    usersGeofire.set(user.uid,[parseFloat(user.location.lat),parseFloat(user.location.lon)]).then(function(){\n                        console.log(\"user\"+user.phone_number+ \" added to the geomap\");\n                        addedUsers.push(user);\n                    }, function(error){\n                        console.log(\"add users to geofire Error: \" + error);\n                        d.reject(error);\n                    });\n                 }\n             } \n             d.resolve(addedUsers);\n        \n        });\n              \n    return d.promise;\n    \n};\nvar addCampaignsToGeofire = function(){\n    var d =q.defer();\n    var campaigns = [];\n    var addedCampaigns=[];\n        new Firebase('https://mtdemo.firebaseio.com/campaigns').on('value', function (snapshot) {\n            campaigns = [];\n            snapshot.forEach(function(refChild) {\n                campaigns.push(refChild.val());\n                    });\n             for (var campaign of campaigns) {\n                if(campaign.location){\n                    campaignsGeofire.set(campaign.cid,[parseFloat(campaign.location.lat),parseFloat(campaign.location.lon)]).then(function(){\n                        console.log(\"campaign\"+campaign.name+ \" added to the geomap\");\n                        addedCampaigns.push(campaign);\n                    }, function(error){\n                        console.log(\"add campaigns to geofire Error: \" + error);\n                        d.reject(error);\n                    });\n                 }\n             }\n             d.resolve(addedCampaigns);\n        \n        });\n              \n    return d.promise;\n    \n};\n\nmodule.exports=geofire_export;\n\n","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":13,"column":8},"end":{"row":13,"column":9},"action":"insert","lines":["a"],"id":1265}],[{"start":{"row":13,"column":9},"end":{"row":13,"column":10},"action":"insert","lines":["d"],"id":1266}],[{"start":{"row":13,"column":10},"end":{"row":13,"column":11},"action":"insert","lines":["d"],"id":1267}],[{"start":{"row":13,"column":11},"end":{"row":13,"column":12},"action":"insert","lines":["e"],"id":1268}],[{"start":{"row":13,"column":12},"end":{"row":13,"column":13},"action":"insert","lines":["d"],"id":1269}],[{"start":{"row":13,"column":13},"end":{"row":13,"column":14},"action":"insert","lines":["."],"id":1270}],[{"start":{"row":12,"column":38},"end":{"row":12,"column":39},"action":"insert","lines":["a"],"id":1271}],[{"start":{"row":12,"column":39},"end":{"row":12,"column":40},"action":"insert","lines":["d"],"id":1272}],[{"start":{"row":12,"column":40},"end":{"row":12,"column":41},"action":"insert","lines":["d"],"id":1273}],[{"start":{"row":12,"column":41},"end":{"row":12,"column":42},"action":"insert","lines":["e"],"id":1274}],[{"start":{"row":12,"column":42},"end":{"row":12,"column":43},"action":"insert","lines":["d"],"id":1275}],[{"start":{"row":12,"column":43},"end":{"row":12,"column":44},"action":"insert","lines":["U"],"id":1281}],[{"start":{"row":12,"column":44},"end":{"row":12,"column":45},"action":"insert","lines":["s"],"id":1282}],[{"start":{"row":12,"column":45},"end":{"row":12,"column":46},"action":"insert","lines":["e"],"id":1283}],[{"start":{"row":12,"column":46},"end":{"row":12,"column":47},"action":"insert","lines":["r"],"id":1284}],[{"start":{"row":12,"column":47},"end":{"row":12,"column":48},"action":"insert","lines":["s"],"id":1285}],[{"start":{"row":13,"column":14},"end":{"row":13,"column":15},"action":"insert","lines":["u"],"id":1286}],[{"start":{"row":13,"column":15},"end":{"row":13,"column":16},"action":"insert","lines":["s"],"id":1287}],[{"start":{"row":13,"column":16},"end":{"row":13,"column":17},"action":"insert","lines":["e"],"id":1288}],[{"start":{"row":13,"column":17},"end":{"row":13,"column":18},"action":"insert","lines":["r"],"id":1289}],[{"start":{"row":13,"column":18},"end":{"row":13,"column":19},"action":"insert","lines":["s"],"id":1290}],[{"start":{"row":13,"column":19},"end":{"row":13,"column":20},"action":"insert","lines":[" "],"id":1291}],[{"start":{"row":13,"column":20},"end":{"row":13,"column":21},"action":"insert","lines":["="],"id":1292}],[{"start":{"row":13,"column":21},"end":{"row":13,"column":22},"action":"insert","lines":[" "],"id":1293}],[{"start":{"row":13,"column":22},"end":{"row":13,"column":32},"action":"insert","lines":["addedUsers"],"id":1294}],[{"start":{"row":13,"column":32},"end":{"row":13,"column":33},"action":"insert","lines":[";"],"id":1295}],[{"start":{"row":13,"column":14},"end":{"row":13,"column":15},"action":"insert","lines":["a"],"id":1296}],[{"start":{"row":13,"column":15},"end":{"row":13,"column":16},"action":"insert","lines":["d"],"id":1297}],[{"start":{"row":13,"column":16},"end":{"row":13,"column":17},"action":"insert","lines":["d"],"id":1298}],[{"start":{"row":13,"column":17},"end":{"row":13,"column":18},"action":"insert","lines":["e"],"id":1299}],[{"start":{"row":13,"column":18},"end":{"row":13,"column":19},"action":"insert","lines":["d"],"id":1300}],[{"start":{"row":13,"column":19},"end":{"row":13,"column":20},"action":"insert","lines":["U"],"id":1301}],[{"start":{"row":13,"column":20},"end":{"row":13,"column":21},"action":"remove","lines":["u"],"id":1302}],[{"start":{"row":11,"column":8},"end":{"row":11,"column":13},"action":"remove","lines":["added"],"id":1303},{"start":{"row":11,"column":8},"end":{"row":11,"column":9},"action":"insert","lines":["r"]}],[{"start":{"row":11,"column":9},"end":{"row":11,"column":10},"action":"insert","lines":["e"],"id":1304}],[{"start":{"row":11,"column":10},"end":{"row":11,"column":11},"action":"insert","lines":["s"],"id":1305}],[{"start":{"row":11,"column":11},"end":{"row":11,"column":12},"action":"insert","lines":["u"],"id":1306}],[{"start":{"row":11,"column":12},"end":{"row":11,"column":13},"action":"insert","lines":["l"],"id":1307}],[{"start":{"row":11,"column":13},"end":{"row":11,"column":14},"action":"insert","lines":["t"],"id":1308}],[{"start":{"row":13,"column":8},"end":{"row":13,"column":13},"action":"remove","lines":["added"],"id":1309},{"start":{"row":13,"column":8},"end":{"row":13,"column":14},"action":"insert","lines":["result"]}],[{"start":{"row":14,"column":46},"end":{"row":14,"column":47},"action":"insert","lines":["a"],"id":1310}],[{"start":{"row":14,"column":47},"end":{"row":14,"column":48},"action":"insert","lines":["d"],"id":1311}],[{"start":{"row":14,"column":48},"end":{"row":14,"column":49},"action":"insert","lines":["d"],"id":1312}],[{"start":{"row":14,"column":49},"end":{"row":14,"column":50},"action":"insert","lines":["e"],"id":1313}],[{"start":{"row":14,"column":50},"end":{"row":14,"column":51},"action":"insert","lines":["d"],"id":1314}],[{"start":{"row":14,"column":51},"end":{"row":14,"column":52},"action":"insert","lines":["C"],"id":1315}],[{"start":{"row":14,"column":52},"end":{"row":14,"column":53},"action":"insert","lines":["a"],"id":1316}],[{"start":{"row":14,"column":53},"end":{"row":14,"column":54},"action":"insert","lines":["m"],"id":1317}],[{"start":{"row":14,"column":54},"end":{"row":14,"column":55},"action":"insert","lines":["p"],"id":1318}],[{"start":{"row":14,"column":55},"end":{"row":14,"column":56},"action":"insert","lines":["a"],"id":1319}],[{"start":{"row":14,"column":56},"end":{"row":14,"column":57},"action":"insert","lines":["i"],"id":1320}],[{"start":{"row":14,"column":57},"end":{"row":14,"column":58},"action":"insert","lines":["g"],"id":1321}],[{"start":{"row":14,"column":58},"end":{"row":14,"column":59},"action":"insert","lines":["n"],"id":1322}],[{"start":{"row":14,"column":59},"end":{"row":14,"column":60},"action":"insert","lines":["s"],"id":1323}],[{"start":{"row":14,"column":62},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":1324},{"start":{"row":15,"column":0},"end":{"row":15,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":15,"column":12},"end":{"row":15,"column":26},"action":"insert","lines":["addedCampaigns"],"id":1325}],[{"start":{"row":15,"column":12},"end":{"row":15,"column":18},"action":"insert","lines":["result"],"id":1326}],[{"start":{"row":15,"column":18},"end":{"row":15,"column":19},"action":"insert","lines":["."],"id":1327}],[{"start":{"row":15,"column":33},"end":{"row":15,"column":34},"action":"insert","lines":["="],"id":1328}],[{"start":{"row":15,"column":34},"end":{"row":15,"column":40},"action":"insert","lines":["result"],"id":1329}],[{"start":{"row":15,"column":40},"end":{"row":15,"column":41},"action":"insert","lines":[";"],"id":1330}],[{"start":{"row":16,"column":22},"end":{"row":16,"column":83},"action":"remove","lines":["{usersGeofire:usersGeofire,campaignsGeofire:campaignsGeofire}"],"id":1331},{"start":{"row":16,"column":22},"end":{"row":16,"column":23},"action":"insert","lines":["r"]}],[{"start":{"row":16,"column":23},"end":{"row":16,"column":24},"action":"insert","lines":["e"],"id":1332}],[{"start":{"row":16,"column":24},"end":{"row":16,"column":25},"action":"insert","lines":["s"],"id":1333}],[{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"insert","lines":["u"],"id":1334}],[{"start":{"row":16,"column":26},"end":{"row":16,"column":27},"action":"insert","lines":["l"],"id":1335}],[{"start":{"row":16,"column":27},"end":{"row":16,"column":28},"action":"insert","lines":["t"],"id":1336}],[{"start":{"row":15,"column":34},"end":{"row":15,"column":40},"action":"remove","lines":["result"],"id":1337},{"start":{"row":15,"column":34},"end":{"row":15,"column":48},"action":"insert","lines":["addedCampaigns"]}],[{"start":{"row":5,"column":42},"end":{"row":5,"column":43},"action":"insert","lines":["."],"id":1338}],[{"start":{"row":5,"column":43},"end":{"row":5,"column":44},"action":"insert","lines":["c"],"id":1339}],[{"start":{"row":5,"column":44},"end":{"row":5,"column":45},"action":"insert","lines":["h"],"id":1340}],[{"start":{"row":5,"column":45},"end":{"row":5,"column":46},"action":"insert","lines":["i"],"id":1341}],[{"start":{"row":5,"column":46},"end":{"row":5,"column":47},"action":"insert","lines":["l"],"id":1342}],[{"start":{"row":5,"column":43},"end":{"row":5,"column":47},"action":"remove","lines":["chil"],"id":1343},{"start":{"row":5,"column":43},"end":{"row":5,"column":50},"action":"insert","lines":["child()"]}],[{"start":{"row":5,"column":49},"end":{"row":5,"column":51},"action":"insert","lines":["\"\""],"id":1344}],[{"start":{"row":5,"column":50},"end":{"row":5,"column":51},"action":"insert","lines":["g"],"id":1345}],[{"start":{"row":5,"column":51},"end":{"row":5,"column":52},"action":"insert","lines":["e"],"id":1346}],[{"start":{"row":5,"column":52},"end":{"row":5,"column":53},"action":"insert","lines":["o"],"id":1347}],[{"start":{"row":5,"column":53},"end":{"row":5,"column":54},"action":"insert","lines":["m"],"id":1348}],[{"start":{"row":5,"column":54},"end":{"row":5,"column":55},"action":"insert","lines":["a"],"id":1349}],[{"start":{"row":5,"column":55},"end":{"row":5,"column":56},"action":"insert","lines":["p"],"id":1350}],[{"start":{"row":6,"column":46},"end":{"row":6,"column":62},"action":"insert","lines":[".child(\"geomap\")"],"id":1351}],[{"start":{"row":56,"column":97},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":1352},{"start":{"row":57,"column":0},"end":{"row":57,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":57,"column":12},"end":{"row":57,"column":26},"action":"insert","lines":["campaigns = []"],"id":1353}],[{"start":{"row":57,"column":26},"end":{"row":57,"column":27},"action":"insert","lines":[";"],"id":1354}],[{"start":{"row":30,"column":93},"end":{"row":31,"column":0},"action":"insert","lines":["",""],"id":1355},{"start":{"row":31,"column":0},"end":{"row":31,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":31,"column":12},"end":{"row":31,"column":22},"action":"insert","lines":["users = []"],"id":1356}],[{"start":{"row":31,"column":22},"end":{"row":31,"column":23},"action":"insert","lines":[";"],"id":1357}],[{"start":{"row":25,"column":1},"end":{"row":26,"column":0},"action":"insert","lines":["",""],"id":1358}],[{"start":{"row":26,"column":0},"end":{"row":26,"column":14},"action":"insert","lines":["geofire_export"],"id":1359}],[{"start":{"row":26,"column":14},"end":{"row":26,"column":15},"action":"insert","lines":["."],"id":1360}],[{"start":{"row":26,"column":15},"end":{"row":26,"column":27},"action":"insert","lines":["usersGeofire"],"id":1361}],[{"start":{"row":26,"column":27},"end":{"row":26,"column":28},"action":"insert","lines":["="],"id":1362}],[{"start":{"row":26,"column":28},"end":{"row":26,"column":40},"action":"insert","lines":["usersGeofire"],"id":1363}],[{"start":{"row":26,"column":40},"end":{"row":26,"column":41},"action":"insert","lines":[";"],"id":1364}],[{"start":{"row":26,"column":41},"end":{"row":27,"column":0},"action":"insert","lines":["",""],"id":1365}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":41},"action":"insert","lines":["geofire_export.usersGeofire=usersGeofire;"],"id":1366}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":14},"action":"remove","lines":["geofire_export"],"id":1367},{"start":{"row":27,"column":0},"end":{"row":27,"column":16},"action":"insert","lines":["campaignsGeofire"]}],[{"start":{"row":27,"column":30},"end":{"row":27,"column":42},"action":"remove","lines":["usersGeofire"],"id":1368},{"start":{"row":27,"column":30},"end":{"row":27,"column":46},"action":"insert","lines":["campaignsGeofire"]}],[{"start":{"row":27,"column":17},"end":{"row":27,"column":29},"action":"remove","lines":["usersGeofire"],"id":1369},{"start":{"row":27,"column":17},"end":{"row":27,"column":33},"action":"insert","lines":["campaignsGeofire"]}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":16},"action":"remove","lines":["campaignsGeofire"],"id":1370},{"start":{"row":27,"column":0},"end":{"row":27,"column":14},"action":"insert","lines":["geofire_export"]}],[{"start":{"row":16,"column":22},"end":{"row":16,"column":28},"action":"remove","lines":["result"],"id":1371}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":16,"column":22},"end":{"row":16,"column":28},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1438769321113}