{"changed":true,"filter":false,"title":"index.js","tooltip":"/routes/index.js","value":"\nvar express = require('express');\nvar twilio = require('twilio');\nvar FirebaseTokenGenerator = require(\"firebase-token-generator\");\nvar DAL = require(\"../firebaseDB\");\nvar router = express.Router();\n\n\n\nrouter.get('/createFirebaseToken/:uid?', function(req, res) {\n  \n  \n    var tokenGenerator = new FirebaseTokenGenerator(\"Cmf7xrUOsFPDtJqpTkOEHRa0E5ss0mtwSYN9xnvF\");\n    var user = DAL.getUserById(req.params.uid,function(user){\n        if(user){\n        var token = tokenGenerator.createToken({uid:String(user.uid)});\n        DAL.addProperty(user.uid,\"firebase_token_first_10\",String(token).slice(0,10));\n        \n        res.send(token);\n        }\n        else{\n            res.send(\"user do not exist\");\n        }\n        \n    });\n\n\n});\n\n\nrouter.get('/twilioTokenGen/:userPhoneNumber?', function(req, res) {\n    \n   \n    var capability = new twilio.Capability(\n       'AC13c8bc5cde5613c706cde6638665d2db',\n        'bb96487cff1af4f655fd2068a0287b6a'\n    );\n        /*var capability = new twilio.Capability(\n        process.env.TWILIO_ACCOUNT_SID,\n        process.env.TWILIO_AUTH_TOKEN\n    );*/\n    \n\n    capability.allowClientIncoming(req.params.userPhoneNumber);\n\n    capability.allowClientOutgoing('AP1cadf539a83d36562bdd268bd96b8903');\n \n res.send(capability.generate());\n    \n\n\n});\n\n\nmodule.exports = router;","undoManager":{"mark":99,"position":100,"stack":[[{"start":{"row":78,"column":40},"end":{"row":78,"column":42},"action":"remove","lines":["tr"],"id":517},{"start":{"row":78,"column":40},"end":{"row":78,"column":44},"action":"insert","lines":["true"]}],[{"start":{"row":78,"column":45},"end":{"row":78,"column":46},"action":"insert","lines":[";"],"id":518}],[{"start":{"row":73,"column":0},"end":{"row":73,"column":1},"action":"insert","lines":[" "],"id":519}],[{"start":{"row":73,"column":1},"end":{"row":73,"column":2},"action":"insert","lines":[" "],"id":520}],[{"start":{"row":73,"column":2},"end":{"row":73,"column":3},"action":"insert","lines":[" "],"id":521}],[{"start":{"row":73,"column":3},"end":{"row":73,"column":4},"action":"insert","lines":["D"],"id":522}],[{"start":{"row":73,"column":4},"end":{"row":73,"column":5},"action":"insert","lines":["A"],"id":523}],[{"start":{"row":73,"column":3},"end":{"row":73,"column":5},"action":"remove","lines":["DA"],"id":524},{"start":{"row":73,"column":3},"end":{"row":73,"column":6},"action":"insert","lines":["DAL"]}],[{"start":{"row":73,"column":6},"end":{"row":73,"column":7},"action":"insert","lines":["."],"id":525}],[{"start":{"row":73,"column":7},"end":{"row":73,"column":8},"action":"insert","lines":["g"],"id":526}],[{"start":{"row":73,"column":8},"end":{"row":73,"column":9},"action":"insert","lines":["e"],"id":527}],[{"start":{"row":73,"column":9},"end":{"row":73,"column":10},"action":"insert","lines":["t"],"id":528}],[{"start":{"row":73,"column":10},"end":{"row":73,"column":11},"action":"insert","lines":["U"],"id":529}],[{"start":{"row":73,"column":7},"end":{"row":73,"column":11},"action":"remove","lines":["getU"],"id":530},{"start":{"row":73,"column":7},"end":{"row":73,"column":28},"action":"insert","lines":["getUidByPhoneNumber()"]}],[{"start":{"row":73,"column":27},"end":{"row":73,"column":28},"action":"insert","lines":["u"],"id":531}],[{"start":{"row":73,"column":27},"end":{"row":73,"column":28},"action":"remove","lines":["u"],"id":532},{"start":{"row":73,"column":27},"end":{"row":73,"column":44},"action":"insert","lines":["user_phone_number"]}],[{"start":{"row":73,"column":45},"end":{"row":73,"column":46},"action":"insert","lines":["."],"id":533}],[{"start":{"row":73,"column":46},"end":{"row":73,"column":47},"action":"insert","lines":["t"],"id":534}],[{"start":{"row":73,"column":47},"end":{"row":73,"column":48},"action":"insert","lines":["h"],"id":535}],[{"start":{"row":73,"column":48},"end":{"row":73,"column":49},"action":"insert","lines":["e"],"id":536}],[{"start":{"row":73,"column":49},"end":{"row":73,"column":50},"action":"insert","lines":["n"],"id":537}],[{"start":{"row":73,"column":50},"end":{"row":73,"column":52},"action":"insert","lines":["()"],"id":538}],[{"start":{"row":73,"column":51},"end":{"row":73,"column":52},"action":"insert","lines":["f"],"id":539}],[{"start":{"row":73,"column":52},"end":{"row":73,"column":53},"action":"insert","lines":["u"],"id":540}],[{"start":{"row":73,"column":53},"end":{"row":73,"column":54},"action":"insert","lines":["n"],"id":541}],[{"start":{"row":73,"column":54},"end":{"row":73,"column":55},"action":"insert","lines":["c"],"id":542}],[{"start":{"row":73,"column":55},"end":{"row":73,"column":56},"action":"insert","lines":["t"],"id":543}],[{"start":{"row":73,"column":56},"end":{"row":73,"column":57},"action":"insert","lines":["i"],"id":544}],[{"start":{"row":73,"column":57},"end":{"row":73,"column":58},"action":"insert","lines":["o"],"id":545}],[{"start":{"row":73,"column":58},"end":{"row":73,"column":59},"action":"insert","lines":["n"],"id":546}],[{"start":{"row":73,"column":59},"end":{"row":73,"column":61},"action":"insert","lines":["()"],"id":547}],[{"start":{"row":73,"column":60},"end":{"row":73,"column":61},"action":"insert","lines":["u"],"id":548}],[{"start":{"row":73,"column":61},"end":{"row":73,"column":62},"action":"insert","lines":["s"],"id":549}],[{"start":{"row":73,"column":62},"end":{"row":73,"column":63},"action":"insert","lines":["e"],"id":550}],[{"start":{"row":73,"column":63},"end":{"row":73,"column":64},"action":"insert","lines":["r"],"id":551}],[{"start":{"row":73,"column":65},"end":{"row":73,"column":67},"action":"insert","lines":["{}"],"id":552}],[{"start":{"row":73,"column":66},"end":{"row":75,"column":3},"action":"insert","lines":["","       ","   "],"id":553}],[{"start":{"row":74,"column":7},"end":{"row":74,"column":8},"action":"insert","lines":["i"],"id":554}],[{"start":{"row":74,"column":8},"end":{"row":74,"column":9},"action":"insert","lines":["f"],"id":555}],[{"start":{"row":74,"column":9},"end":{"row":74,"column":11},"action":"insert","lines":["()"],"id":556}],[{"start":{"row":74,"column":10},"end":{"row":74,"column":11},"action":"insert","lines":["u"],"id":557}],[{"start":{"row":74,"column":11},"end":{"row":74,"column":12},"action":"insert","lines":["s"],"id":558}],[{"start":{"row":74,"column":10},"end":{"row":74,"column":12},"action":"remove","lines":["us"],"id":559},{"start":{"row":74,"column":10},"end":{"row":74,"column":14},"action":"insert","lines":["user"]}],[{"start":{"row":74,"column":14},"end":{"row":74,"column":15},"action":"insert","lines":["."],"id":560}],[{"start":{"row":74,"column":15},"end":{"row":74,"column":16},"action":"insert","lines":["i"],"id":561}],[{"start":{"row":74,"column":16},"end":{"row":74,"column":17},"action":"insert","lines":["s"],"id":562}],[{"start":{"row":74,"column":17},"end":{"row":74,"column":18},"action":"insert","lines":["F"],"id":563}],[{"start":{"row":74,"column":15},"end":{"row":74,"column":18},"action":"remove","lines":["isF"],"id":564},{"start":{"row":74,"column":15},"end":{"row":74,"column":21},"action":"insert","lines":["isFull"]}],[{"start":{"row":74,"column":22},"end":{"row":75,"column":0},"action":"insert","lines":["",""],"id":565},{"start":{"row":75,"column":0},"end":{"row":75,"column":7},"action":"insert","lines":["       "]}],[{"start":{"row":75,"column":7},"end":{"row":75,"column":8},"action":"insert","lines":["r"],"id":566}],[{"start":{"row":75,"column":8},"end":{"row":75,"column":9},"action":"insert","lines":["e"],"id":567}],[{"start":{"row":75,"column":9},"end":{"row":75,"column":10},"action":"insert","lines":["s"],"id":568}],[{"start":{"row":75,"column":10},"end":{"row":75,"column":11},"action":"insert","lines":["."],"id":569}],[{"start":{"row":75,"column":11},"end":{"row":75,"column":17},"action":"insert","lines":["send()"],"id":570}],[{"start":{"row":75,"column":16},"end":{"row":75,"column":17},"action":"insert","lines":["u"],"id":574}],[{"start":{"row":75,"column":17},"end":{"row":75,"column":18},"action":"insert","lines":["s"],"id":575}],[{"start":{"row":75,"column":18},"end":{"row":75,"column":19},"action":"insert","lines":["e"],"id":576}],[{"start":{"row":75,"column":19},"end":{"row":75,"column":20},"action":"insert","lines":["r"],"id":577}],[{"start":{"row":75,"column":21},"end":{"row":75,"column":22},"action":"insert","lines":[";"],"id":578}],[{"start":{"row":75,"column":22},"end":{"row":76,"column":0},"action":"insert","lines":["",""],"id":579},{"start":{"row":76,"column":0},"end":{"row":76,"column":7},"action":"insert","lines":["       "]}],[{"start":{"row":76,"column":7},"end":{"row":76,"column":8},"action":"insert","lines":["e"],"id":580}],[{"start":{"row":76,"column":8},"end":{"row":76,"column":9},"action":"insert","lines":["l"],"id":581}],[{"start":{"row":76,"column":9},"end":{"row":76,"column":10},"action":"insert","lines":["s"],"id":582}],[{"start":{"row":76,"column":10},"end":{"row":76,"column":11},"action":"insert","lines":["e"],"id":583}],[{"start":{"row":76,"column":11},"end":{"row":76,"column":12},"action":"insert","lines":["{"],"id":584}],[{"start":{"row":76,"column":12},"end":{"row":78,"column":8},"action":"insert","lines":["","           ","       }"],"id":585}],[{"start":{"row":80,"column":0},"end":{"row":100,"column":6},"action":"remove","lines":["   DAL.getUidByPhoneNumber(user_phone_number).then(function(uid){","       for(var prop in data_to_add){","           DAL.addProperty(uid,prop,data_to_add[prop]);","       }","           DAL.addProperty(uid,\"isFull\",true);","        DAL.getUserById(uid,function(fullUser){","               if(fullUser)","               {","               res.send(fullUser);","               }","               else","               {","                   res.writeHead(413, 'Faild To Update User Data', {'Content-Type': 'text/html'});","                      res.end('<!doctype html><html><head><title>413</title></head><body>413: Faild To Update User Data</body></html>')","               }","                        ","        });","   ","","  ","   });"],"id":586}],[{"start":{"row":77,"column":11},"end":{"row":97,"column":6},"action":"insert","lines":["   DAL.getUidByPhoneNumber(user_phone_number).then(function(uid){","       for(var prop in data_to_add){","           DAL.addProperty(uid,prop,data_to_add[prop]);","       }","           DAL.addProperty(uid,\"isFull\",true);","        DAL.getUserById(uid,function(fullUser){","               if(fullUser)","               {","               res.send(fullUser);","               }","               else","               {","                   res.writeHead(413, 'Faild To Update User Data', {'Content-Type': 'text/html'});","                      res.end('<!doctype html><html><head><title>413</title></head><body>413: Faild To Update User Data</body></html>')","               }","                        ","        });","   ","","  ","   });"],"id":587}],[{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"insert","lines":["    "],"id":588},{"start":{"row":79,"column":0},"end":{"row":79,"column":4},"action":"insert","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"insert","lines":["    "],"id":589},{"start":{"row":79,"column":0},"end":{"row":79,"column":4},"action":"insert","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"insert","lines":["    "],"id":590},{"start":{"row":79,"column":0},"end":{"row":79,"column":4},"action":"insert","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":81,"column":10},"end":{"row":81,"column":12},"action":"insert","lines":["  "],"id":591}],[{"start":{"row":81,"column":12},"end":{"row":81,"column":16},"action":"insert","lines":["    "],"id":592}],[{"start":{"row":81,"column":16},"end":{"row":81,"column":20},"action":"insert","lines":["    "],"id":593}],[{"start":{"row":81,"column":20},"end":{"row":81,"column":24},"action":"insert","lines":["    "],"id":594}],[{"start":{"row":81,"column":20},"end":{"row":81,"column":24},"action":"remove","lines":["    "],"id":595}],[{"start":{"row":81,"column":20},"end":{"row":81,"column":24},"action":"insert","lines":["    "],"id":596}],[{"start":{"row":81,"column":24},"end":{"row":81,"column":25},"action":"insert","lines":[" "],"id":597}],[{"start":{"row":81,"column":24},"end":{"row":81,"column":25},"action":"remove","lines":[" "],"id":598}],[{"start":{"row":81,"column":20},"end":{"row":81,"column":24},"action":"remove","lines":["    "],"id":599}],[{"start":{"row":81,"column":20},"end":{"row":81,"column":21},"action":"insert","lines":[" "],"id":600}],[{"start":{"row":81,"column":21},"end":{"row":81,"column":22},"action":"insert","lines":[" "],"id":601}],[{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"insert","lines":["    "],"id":602},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"insert","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"insert","lines":["    "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"insert","lines":["    "]},{"start":{"row":86,"column":0},"end":{"row":86,"column":4},"action":"insert","lines":["    "]},{"start":{"row":87,"column":0},"end":{"row":87,"column":4},"action":"insert","lines":["    "]},{"start":{"row":88,"column":0},"end":{"row":88,"column":4},"action":"insert","lines":["    "]},{"start":{"row":89,"column":0},"end":{"row":89,"column":4},"action":"insert","lines":["    "]},{"start":{"row":90,"column":0},"end":{"row":90,"column":4},"action":"insert","lines":["    "]},{"start":{"row":91,"column":0},"end":{"row":91,"column":4},"action":"insert","lines":["    "]},{"start":{"row":92,"column":0},"end":{"row":92,"column":4},"action":"insert","lines":["    "]},{"start":{"row":93,"column":0},"end":{"row":93,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"insert","lines":["    "],"id":603},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"insert","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"insert","lines":["    "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"insert","lines":["    "]},{"start":{"row":86,"column":0},"end":{"row":86,"column":4},"action":"insert","lines":["    "]},{"start":{"row":87,"column":0},"end":{"row":87,"column":4},"action":"insert","lines":["    "]},{"start":{"row":88,"column":0},"end":{"row":88,"column":4},"action":"insert","lines":["    "]},{"start":{"row":89,"column":0},"end":{"row":89,"column":4},"action":"insert","lines":["    "]},{"start":{"row":90,"column":0},"end":{"row":90,"column":4},"action":"insert","lines":["    "]},{"start":{"row":91,"column":0},"end":{"row":91,"column":4},"action":"insert","lines":["    "]},{"start":{"row":92,"column":0},"end":{"row":92,"column":4},"action":"insert","lines":["    "]},{"start":{"row":93,"column":0},"end":{"row":93,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"insert","lines":["    "],"id":604},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"insert","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"insert","lines":["    "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"insert","lines":["    "]},{"start":{"row":86,"column":0},"end":{"row":86,"column":4},"action":"insert","lines":["    "]},{"start":{"row":87,"column":0},"end":{"row":87,"column":4},"action":"insert","lines":["    "]},{"start":{"row":88,"column":0},"end":{"row":88,"column":4},"action":"insert","lines":["    "]},{"start":{"row":89,"column":0},"end":{"row":89,"column":4},"action":"insert","lines":["    "]},{"start":{"row":90,"column":0},"end":{"row":90,"column":4},"action":"insert","lines":["    "]},{"start":{"row":91,"column":0},"end":{"row":91,"column":4},"action":"insert","lines":["    "]},{"start":{"row":92,"column":0},"end":{"row":92,"column":4},"action":"insert","lines":["    "]},{"start":{"row":93,"column":0},"end":{"row":93,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":97,"column":3},"end":{"row":97,"column":4},"action":"insert","lines":[" "],"id":605}],[{"start":{"row":97,"column":4},"end":{"row":97,"column":8},"action":"insert","lines":["    "],"id":606}],[{"start":{"row":97,"column":8},"end":{"row":97,"column":12},"action":"insert","lines":["    "],"id":607}],[{"start":{"row":97,"column":12},"end":{"row":97,"column":16},"action":"insert","lines":["    "],"id":608}],[{"start":{"row":97,"column":16},"end":{"row":97,"column":20},"action":"insert","lines":["    "],"id":609}],[{"start":{"row":97,"column":16},"end":{"row":97,"column":20},"action":"remove","lines":["    "],"id":610}],[{"start":{"row":99,"column":5},"end":{"row":99,"column":6},"action":"insert","lines":[";"],"id":611}],[{"start":{"row":98,"column":7},"end":{"row":98,"column":8},"action":"insert","lines":[" "],"id":612}],[{"start":{"row":98,"column":8},"end":{"row":98,"column":9},"action":"insert","lines":[" "],"id":613}],[{"start":{"row":98,"column":9},"end":{"row":98,"column":10},"action":"insert","lines":[" "],"id":614}],[{"start":{"row":98,"column":10},"end":{"row":98,"column":11},"action":"insert","lines":[" "],"id":615}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":67},"action":"remove","lines":["//var FirebaseTokenGenerator = require(\"firebase-token-generator\");"],"id":616}],[{"start":{"row":8,"column":0},"end":{"row":17,"column":3},"action":"insert","lines":["router.get('/CreateCampaign', function(req, res) {","    ","        res.render('CreateCampaign.ejs', {","        token:'lolz',","        userName:'kevin'","    });","    ","","","});"],"id":617}],[{"start":{"row":8,"column":0},"end":{"row":17,"column":3},"action":"remove","lines":["router.get('/CreateCampaign', function(req, res) {","    ","        res.render('CreateCampaign.ejs', {","        token:'lolz',","        userName:'kevin'","    });","    ","","","});"],"id":618}],[{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"remove","lines":["",""],"id":619}],[{"start":{"row":52,"column":0},"end":{"row":103,"column":3},"action":"remove","lines":["","router.get('/getUidByPhoneNumber/:userPhoneNumber?', function(req, res) {","  ","   DAL.getUidByPhoneNumber(req.params.userPhoneNumber).then(function(uid){","        res.send(uid);","      ","  },function(){","      res.send(\"no user found\");","  });","  ","  ","  ","","","});","","router.post('/mergeFullUser', function(req, res) {","  ","   var data_to_add = req.body.data_to_add;","   var user_phone_number=req.body.user_phone_number;","   DAL.getUidByPhoneNumber(user_phone_number).then(function(user){","       if(user.isFull)","       res.send(user);","       else{","              DAL.getUidByPhoneNumber(user_phone_number).then(function(uid){","                   for(var prop in data_to_add){","                       DAL.addProperty(uid,prop,data_to_add[prop]);","                   }","                       DAL.addProperty(uid,\"isFull\",true);","                    DAL.getUserById(uid,function(fullUser){","                           if(fullUser)","                           {","                           res.send(fullUser);","                           }","                           else","                           {","                               res.writeHead(413, 'Faild To Update User Data', {'Content-Type': 'text/html'});","                                  res.end('<!doctype html><html><head><title>413</title></head><body>413: Faild To Update User Data</body></html>')","                           }","                                    ","                    });","   ","","  ","                });","           }","   });","","  ","","","});"],"id":620}]]},"ace":{"folds":[],"scrolltop":540,"scrollleft":0,"selection":{"start":{"row":52,"column":0},"end":{"row":52,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":27,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1437479846973}